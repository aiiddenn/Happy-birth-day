<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Prescription - Just for You</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #fff0f7 0%, #f0f4ff 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 900px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
        }

        .header h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            color: #ff4081;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto 20px;
        }

        .prescription-card {
            width: 100%;
            max-width: 700px;
            background-color: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            cursor: pointer;
        }

        .prescription-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }

        .prescription-card.locked {
            cursor: not-allowed;
            opacity: 0.9;
        }

        .prescription-card.locked:hover {
            transform: none;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }

        .prescription-header {
            background: linear-gradient(135deg, #ff4081, #ff79b0);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .prescription-header:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, #ffeb3b, #ff4081, #ffeb3b);
        }

        .prescription-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: white;
        }

        .prescription-title {
            font-family: 'Dancing Script', cursive;
            font-size: 2.8rem;
            margin-bottom: 5px;
        }

        .prescription-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .prescription-body {
            padding: 40px;
            text-align: center;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .prescription-message {
            font-size: 1.6rem;
            line-height: 1.8;
            color: #444;
            font-weight: 500;
            margin-bottom: 30px;
            font-family: 'Dancing Script', cursive;
            text-align: center;
            padding: 0 20px;
            max-width: 600px;
        }

        .prescription-footer {
            font-size: 1rem;
            color: #888;
            font-style: italic;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #e0e0e0;
            width: 100%;
        }

        .lock-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #ff4081;
            font-size: 1.5rem;
            opacity: 0.7;
        }

        .timer-display {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 15px 25px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .timer-icon {
            color: #ff4081;
            font-size: 1.5rem;
        }

        .timer-text {
            font-size: 1.1rem;
            color: #555;
            font-weight: 500;
        }

        .timer-countdown {
            font-weight: 700;
            color: #ff4081;
            font-size: 1.2rem;
            min-width: 80px;
            text-align: center;
        }

        .note {
            background-color: #fff8e1;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #ffeb3b;
        }

        .note h3 {
            color: #ff9800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .note p {
            color: #666;
            line-height: 1.6;
        }

        .heart-float {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .heart {
            position: absolute;
            color: rgba(255, 64, 129, 0.3);
            font-size: 1.2rem;
            animation: floatHeart 15s linear infinite;
        }

        @keyframes floatHeart {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .floating-hearts {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .heart-particle {
            position: absolute;
            color: #ff4081;
            font-size: 1rem;
            opacity: 0;
        }

        .click-instruction {
            text-align: center;
            color: #666;
            font-size: 1.1rem;
            margin-top: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #777;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.8rem;
            }
            
            .prescription-card {
                max-width: 90%;
            }
            
            .prescription-body {
                padding: 30px 20px;
            }
            
            .prescription-message {
                font-size: 1.4rem;
                line-height: 1.6;
            }
            
            .timer-display {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .prescription-title {
                font-size: 2.2rem;
            }
            
            .prescription-message {
                font-size: 1.3rem;
            }
            
            .note {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="heart-float" id="heartFloat"></div>
    
    <div class="container">
        <div class="header">
            <h1>Daily Prescription</h1>
            <p>A special dose of love and compliments, just for you</p>
        </div>
        
        <div class="prescription-card" id="prescriptionCard">
            <div class="floating-hearts" id="floatingHearts"></div>
            
            <div class="prescription-header">
                <div class="prescription-icon">
                    <i class="fas fa-heart-circle-plus"></i>
                </div>
                <div class="prescription-title">Daily Love Prescription</div>
                <div class="prescription-subtitle">Your daily dose of love and compliments</div>
            </div>
            
            <div class="prescription-body" id="prescriptionBody">
                <div class="lock-icon" id="lockIcon">
                    <i class="fas fa-lock-open"></i>
                </div>
                
                <div class="prescription-message" id="prescriptionMessage">
                    Click to receive your daily prescription of love
                </div>
                
                <div class="prescription-footer" id="prescriptionFooter">
                    Prescribed with love by your hubby
                </div>
            </div>
        </div>
        
        <div class="timer-display" id="timerDisplay" style="display: none;">
            <i class="fas fa-clock timer-icon"></i>
            <span class="timer-text">Next prescription available in:</span>
            <span class="timer-countdown" id="timerCountdown">24:00:00</span>
        </div>
        
        <div class="note">
            <h3><i class="fas fa-info-circle"></i> Important Note</h3>
            <p>Your daily prescription will only show for 24 hours. After that, it will disappear and you can get a new one. This ensures you get a fresh dose of love every day!</p>
        </div>
        
        <div class="click-instruction" id="clickInstruction">
            <i class="fas fa-hand-pointer"></i> Click the card above to get your daily prescription
        </div>
        
        <div class="footer">
            <p>Made with <i class="fas fa-heart" style="color:#ff4081;"></i> for the most amazing person</p>
            <p>Each prescription is a reminder of how special you are</p>
        </div>
    </div>

    <script>
        // Daily compliments/prescriptions
        const prescriptions = [
            "You make my life sweeter just by being in it my sweet baby.",
            "Every day I wake up to your thought and I'm always reminded how lucky I am.",
            "Your smile fixes parts of me I didn't know were broken.",
            "You made me feel loved in a way I never been loved like it before.",
            'I admire your soul more than anything about you ":)".',
            "Being loved by you is my greatest blessing.",
            "I'm proud of the woman you are and the woman you're becoming.",
            "Loving you comes naturally to me.",
            "You are my peace in a noisy world."
        ];

        // DOM elements
        const prescriptionCard = document.getElementById('prescriptionCard');
        const prescriptionBody = document.getElementById('prescriptionBody');
        const prescriptionMessage = document.getElementById('prescriptionMessage');
        const prescriptionFooter = document.getElementById('prescriptionFooter');
        const lockIcon = document.getElementById('lockIcon');
        const timerDisplay = document.getElementById('timerDisplay');
        const timerCountdown = document.getElementById('timerCountdown');
        const heartFloat = document.getElementById('heartFloat');
        const floatingHearts = document.getElementById('floatingHearts');
        const clickInstruction = document.getElementById('clickInstruction');
        
        // State variables
        let currentPrescriptionIndex = -1;
        let nextAvailableTime = null;
        let isLocked = false;
        let countdownInterval = null;
        
        // Create floating hearts background
        function createFloatingHearts() {
            for (let i = 0; i < 25; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = '<i class="fas fa-heart"></i>';
                heart.style.left = `${Math.random() * 100}%`;
                heart.style.animationDuration = `${15 + Math.random() * 15}s`;
                heart.style.animationDelay = `${Math.random() * 10}s`;
                heart.style.fontSize = `${0.8 + Math.random() * 1.5}rem`;
                heart.style.color = i % 3 === 0 ? 'rgba(255, 64, 129, 0.4)' : 
                                    i % 3 === 1 ? 'rgba(255, 107, 158, 0.4)' : 
                                    'rgba(255, 153, 187, 0.4)';
                heartFloat.appendChild(heart);
            }
        }
        
        // Create heart particles animation
        function createHeartParticles() {
            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart-particle';
                heart.innerHTML = '<i class="fas fa-heart"></i>';
                heart.style.left = `${Math.random() * 100}%`;
                heart.style.top = `${Math.random() * 100}%`;
                heart.style.fontSize = `${0.8 + Math.random() * 1.2}rem`;
                heart.style.color = i % 2 === 0 ? '#ff4081' : '#ff79b0';
                floatingHearts.appendChild(heart);
                
                // Animate heart
                setTimeout(() => {
                    heart.style.transition = 'all 1.5s ease';
                    heart.style.opacity = '1';
                    heart.style.transform = `translate(${Math.random() * 100 - 50}px, ${-80 - Math.random() * 100}px) rotate(${Math.random() * 360}deg)`;
                    
                    // Remove heart after animation
                    setTimeout(() => {
                        heart.remove();
                    }, 1500);
                }, 100);
            }
        }
        
        // Load saved state from localStorage - FIXED VERSION
        function loadSavedState() {
            const savedState = localStorage.getItem('dailyPrescriptionState');
            
            if (savedState) {
                const state = JSON.parse(savedState);
                currentPrescriptionIndex = state.currentPrescriptionIndex;
                nextAvailableTime = new Date(state.nextAvailableTime);
                
                // Check if 24 hours have passed
                const now = new Date();
                if (now >= nextAvailableTime) {
                    // Time's up, reset state
                    console.log("Time's up, resetting state");
                    resetPrescriptionState();
                } else {
                    // Still locked, show the saved prescription
                    console.log("Still locked, showing saved prescription");
                    isLocked = true;
                    showPrescription(currentPrescriptionIndex, false); // false = not a new prescription
                    updateTimerDisplay();
                    startCountdownTimer();
                }
            } else {
                // First time user, show initial state
                console.log("First time user, showing initial state");
                resetPrescriptionState();
            }
        }
        
        // Save state to localStorage
        function saveState() {
            const state = {
                currentPrescriptionIndex: currentPrescriptionIndex,
                nextAvailableTime: nextAvailableTime.toISOString()
            };
            
            localStorage.setItem('dailyPrescriptionState', JSON.stringify(state));
            console.log("State saved:", state);
        }
        
        // Reset prescription state (when 24 hours have passed or first time)
        function resetPrescriptionState() {
            currentPrescriptionIndex = -1;
            nextAvailableTime = null;
            isLocked = false;
            
            // Clear any existing countdown
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            
            // Reset UI
            prescriptionMessage.textContent = "Click to receive your daily prescription of love";
            prescriptionFooter.textContent = "Prescribed with love by your hubby";
            lockIcon.innerHTML = '<i class="fas fa-lock-open"></i>';
            prescriptionCard.classList.remove('locked');
            timerDisplay.style.display = "none";
            timerCountdown.textContent = "24:00:00";
            clickInstruction.style.display = "block";
            
            console.log("State reset - ready for first prescription");
        }
        
        // Get a random prescription (make sure it's not the same as the last one)
        function getRandomPrescription() {
            let newIndex;
            
            // If we have few prescriptions or it's the first one, just get random
            if (prescriptions.length <= 1 || currentPrescriptionIndex === -1) {
                newIndex = Math.floor(Math.random() * prescriptions.length);
            } else {
                // Get a different index than the current one
                do {
                    newIndex = Math.floor(Math.random() * prescriptions.length);
                } while (newIndex === currentPrescriptionIndex);
            }
            
            return newIndex;
        }
        
        // Show prescription - updated to handle both new and existing
        function showPrescription(index, isNew = true) {
            currentPrescriptionIndex = index;
            
            // Update UI
            prescriptionMessage.textContent = prescriptions[index];
            
            if (isNew) {
                // This is a new prescription
                prescriptionFooter.textContent = `Prescribed on ${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`;
                
                // Set next available time (24 hours from now)
                nextAvailableTime = new Date();
                nextAvailableTime.setHours(nextAvailableTime.getHours() + 24);
                
                console.log("New prescription set. Next available at:", nextAvailableTime);
                
                // Create heart particles
                createHeartParticles();
                
                // Save state
                saveState();
            } else {
                // This is an existing prescription being displayed
                const prescribedDate = new Date(nextAvailableTime.getTime() - (24 * 60 * 60 * 1000));
                prescriptionFooter.textContent = `Prescribed on ${prescribedDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`;
                
                console.log("Existing prescription displayed. Next available at:", nextAvailableTime);
            }
            
            lockIcon.innerHTML = '<i class="fas fa-lock"></i>';
            prescriptionCard.classList.add('locked');
            timerDisplay.style.display = "flex";
            clickInstruction.style.display = "none";
            isLocked = true;
            
            // Update timer display
            updateTimerDisplay();
            
            // Start countdown timer
            startCountdownTimer();
        }
        
        // Update timer display
        function updateTimerDisplay() {
            if (!nextAvailableTime) return;
            
            const now = new Date();
            const timeDiff = nextAvailableTime - now;
            
            if (timeDiff <= 0) {
                // Time's up, reset
                console.log("Timer reached zero, resetting");
                resetPrescriptionState();
                return;
            }
            
            // Calculate hours, minutes, seconds
            const hours = Math.floor(timeDiff / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
            
            // Format as HH:MM:SS
            const formattedTime = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            timerCountdown.textContent = formattedTime;
        }
        
        // Start countdown timer
        function startCountdownTimer() {
            // Clear any existing interval
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            // Update every second
            countdownInterval = setInterval(updateTimerDisplay, 1000);
        }
        
        // Handle prescription card click
        function handlePrescriptionClick() {
            if (isLocked) {
                // Card is locked, show a gentle message
                const originalMessage = prescriptionMessage.textContent;
                prescriptionMessage.textContent = "Your next prescription will be available soon!";
                prescriptionMessage.style.color = "#ff4081";
                
                setTimeout(() => {
                    prescriptionMessage.textContent = originalMessage;
                    prescriptionMessage.style.color = "";
                }, 1500);
                return;
            }
            
            // Get a new prescription
            const newIndex = getRandomPrescription();
            showPrescription(newIndex, true);
        }
        
        // Initialize app
        function init() {
            // Create floating hearts
            createFloatingHearts();
            
            // Load saved state
            loadSavedState();
            
            // Add click event listener to card
            prescriptionCard.addEventListener('click', handlePrescriptionClick);
            
            // Show welcome message in console
            console.log("%cüíù Daily Prescription App üíù", "color: #ff4081; font-size: 24px; font-weight: bold; font-family: 'Dancing Script', cursive;");
            console.log("%cA daily dose of love and compliments for the most special person.", "color: #666; font-size: 14px;");
            
            // Debug: Show current state
            console.log("Initial state loaded:", {
                currentPrescriptionIndex,
                nextAvailableTime,
                isLocked,
                localStorageState: localStorage.getItem('dailyPrescriptionState')
            });
        }
        
        // Start the app
        init();
    </script>
</body>
</html>